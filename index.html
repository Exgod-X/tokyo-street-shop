<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUXA ‚Äî Wear the World</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://js.stripe.com/v3/"></script>

    <style>
        :root {
            --cream:    #FAF8F4;
            --warm:     #F2EDE6;
            --charcoal: #1C1C1E;
            --mid:      #6B6560;
            --gold:     #B8955A;
            --gold-lt:  #D4B483;
            --terra:    #C07B5E;
            --border:   #E5DDD5;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--cream);
            color: var(--charcoal);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .serif { font-family: 'Cormorant Garamond', Georgia, serif; }

        /* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--warm); }
        ::-webkit-scrollbar-thumb { background: var(--gold-lt); border-radius: 3px; }

        /* ‚îÄ‚îÄ ANNOUNCEMENT BAR ‚îÄ‚îÄ */
        .announce-bar {
            background: var(--charcoal);
            color: #fff;
            font-size: 12px;
            letter-spacing: 0.12em;
            text-align: center;
            padding: 10px;
            overflow: hidden;
        }
        .announce-scroll {
            display: inline-block;
            animation: marquee 28s linear infinite;
            white-space: nowrap;
        }
        @keyframes marquee {
            from { transform: translateX(100vw); }
            to   { transform: translateX(-100%); }
        }

        /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
        .nav {
            position: fixed;
            top: 34px;
            width: 100%;
            z-index: 50;
            background: rgba(250,248,244,0.92);
            backdrop-filter: blur(18px);
            -webkit-backdrop-filter: blur(18px);
            border-bottom: 1px solid var(--border);
            transition: top 0.3s ease, box-shadow 0.3s;
        }
        .nav.scrolled { top: 0; box-shadow: 0 2px 24px rgba(0,0,0,0.06); }
        .nav-link {
            font-size: 13px;
            letter-spacing: 0.08em;
            color: var(--mid);
            text-transform: uppercase;
            font-weight: 500;
            transition: color 0.2s;
        }
        .nav-link:hover { color: var(--charcoal); }

        /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
        .btn-dark {
            background: var(--charcoal);
            color: #fff;
            border: 1.5px solid var(--charcoal);
            font-size: 12px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            font-weight: 600;
            padding: 14px 32px;
            border-radius: 2px;
            transition: all 0.2s ease;
            cursor: pointer;
            display: inline-block;
        }
        .btn-dark:hover { background: #3a3a3a; }

        .btn-outline {
            background: transparent;
            color: var(--charcoal);
            border: 1.5px solid var(--charcoal);
            font-size: 12px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            font-weight: 600;
            padding: 14px 32px;
            border-radius: 2px;
            transition: all 0.2s ease;
            cursor: pointer;
            display: inline-block;
        }
        .btn-outline:hover { background: var(--charcoal); color: #fff; }

        .btn-gold {
            background: var(--gold);
            color: #fff;
            border: 1.5px solid var(--gold);
            font-size: 12px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            font-weight: 600;
            padding: 16px 40px;
            border-radius: 2px;
            transition: all 0.2s ease;
            cursor: pointer;
            display: inline-block;
        }
        .btn-gold:hover { background: #a0803f; }

        /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
        .hero {
            height: 100vh;
            min-height: 700px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: flex-end;
        }
        .hero-img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 115%;
            object-fit: cover;
            transform: translateY(0);
            transition: transform 0.1s linear;
        }
        .hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(
                to top,
                rgba(28,28,30,0.75) 0%,
                rgba(28,28,30,0.2) 55%,
                transparent 100%
            );
        }
        .hero-content {
            position: relative;
            z-index: 2;
            padding: 0 6% 8%;
            max-width: 760px;
        }
        .hero-label {
            font-size: 11px;
            letter-spacing: 0.22em;
            text-transform: uppercase;
            color: var(--gold-lt);
            font-weight: 500;
            margin-bottom: 20px;
            opacity: 0;
            animation: fadeUp 0.9s 0.2s ease forwards;
        }
        .hero-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: clamp(68px, 10vw, 130px);
            font-weight: 300;
            line-height: 0.88;
            color: #fff;
            margin-bottom: 28px;
            opacity: 0;
            animation: fadeUp 0.9s 0.4s ease forwards;
            letter-spacing: -0.01em;
        }
        .hero-title em { font-style: italic; color: var(--gold-lt); }
        .hero-sub {
            font-size: 16px;
            color: rgba(255,255,255,0.75);
            font-weight: 300;
            max-width: 420px;
            line-height: 1.7;
            margin-bottom: 36px;
            opacity: 0;
            animation: fadeUp 0.9s 0.6s ease forwards;
        }
        .hero-ctas {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            opacity: 0;
            animation: fadeUp 0.9s 0.75s ease forwards;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(24px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* ‚îÄ‚îÄ POD BANNER ‚îÄ‚îÄ */
        .pod-banner {
            background: var(--warm);
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }
        .pod-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 28px 0;
        }
        .pod-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--charcoal);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 18px;
        }

        /* ‚îÄ‚îÄ SECTION TITLES ‚îÄ‚îÄ */
        .section-eyebrow {
            font-size: 11px;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--gold);
            font-weight: 500;
            margin-bottom: 12px;
        }
        .section-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: clamp(42px, 5vw, 72px);
            font-weight: 300;
            line-height: 1.0;
            letter-spacing: -0.01em;
        }
        .section-title em { font-style: italic; }

        /* ‚îÄ‚îÄ CATEGORY GRID ‚îÄ‚îÄ */
        .cat-card {
            position: relative;
            overflow: hidden;
            cursor: pointer;
            background: var(--warm);
        }
        .cat-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.7s cubic-bezier(0.4,0,0.2,1);
        }
        .cat-card:hover img { transform: scale(1.07); }
        .cat-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(28,28,30,0.65) 0%, transparent 55%);
            transition: opacity 0.3s;
        }
        .cat-label {
            position: absolute;
            bottom: 28px;
            left: 28px;
            right: 28px;
        }
        .cat-name {
            font-family: 'Cormorant Garamond', serif;
            font-size: 34px;
            font-weight: 400;
            color: #fff;
            letter-spacing: 0.02em;
            line-height: 1.1;
        }
        .cat-sub {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-top: 4px;
        }

        /* ‚îÄ‚îÄ PRODUCT CARDS ‚îÄ‚îÄ */
        .prod-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .prod-card:hover { transform: translateY(-3px); }
        .prod-img-wrap {
            overflow: hidden;
            background: var(--warm);
            aspect-ratio: 3/4;
            position: relative;
        }
        .prod-img-wrap img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s cubic-bezier(0.4,0,0.2,1);
        }
        .prod-card:hover .prod-img-wrap img { transform: scale(1.06); }
        .prod-badge {
            position: absolute;
            top: 14px;
            left: 14px;
            background: var(--charcoal);
            color: #fff;
            font-size: 10px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 1px;
        }
        .prod-badge.new { background: var(--gold); }
        .prod-badge.pod { background: var(--terra); }
        .prod-name {
            font-family: 'Cormorant Garamond', serif;
            font-size: 18px;
            font-weight: 400;
            margin-top: 14px;
            margin-bottom: 2px;
            letter-spacing: 0.01em;
        }
        .prod-meta {
            font-size: 12px;
            color: var(--mid);
            letter-spacing: 0.06em;
            text-transform: uppercase;
            margin-bottom: 6px;
        }
        .prod-price {
            font-size: 15px;
            font-weight: 600;
            color: var(--charcoal);
        }

        /* ‚îÄ‚îÄ HOW IT WORKS ‚îÄ‚îÄ */
        .how-step {
            display: flex;
            gap: 28px;
            align-items: flex-start;
            padding: 32px 0;
            border-top: 1px solid var(--border);
        }
        .step-num {
            font-family: 'Cormorant Garamond', serif;
            font-size: 52px;
            font-weight: 300;
            color: var(--border);
            line-height: 1;
            flex-shrink: 0;
            width: 64px;
        }

        /* ‚îÄ‚îÄ CART SIDEBAR ‚îÄ‚îÄ */
        .cart-overlay-bg {
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            position: fixed;
            inset: 0;
            background: rgba(28,28,30,0.4);
            z-index: 70;
        }
        .cart-overlay-bg.open { opacity: 1; visibility: visible; }
        .cart-sidebar {
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4,0,0.2,1);
            position: fixed;
            top: 0; right: 0;
            height: 100%;
            width: 100%;
            max-width: 440px;
            background: var(--cream);
            z-index: 80;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--border);
        }
        .cart-sidebar.open { transform: translateX(0); }

        /* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
        .modal-overlay {
            opacity: 0; visibility: hidden;
            transition: all 0.3s ease;
            position: fixed;
            inset: 0;
            background: rgba(28,28,30,0.5);
            z-index: 90;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-overlay.open { opacity: 1; visibility: visible; }
        .modal-box {
            transform: scale(0.96) translateY(16px);
            transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
            background: var(--cream);
            border-radius: 2px;
            max-width: 860px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-overlay.open .modal-box { transform: scale(1) translateY(0); }

        /* ‚îÄ‚îÄ AUTH MODAL ‚îÄ‚îÄ */
        .auth-modal {
            opacity: 0; visibility: hidden; pointer-events: none;
            transition: all 0.3s ease;
            position: fixed; inset: 0;
            background: rgba(28,28,30,0.5);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .auth-modal.open { opacity: 1; visibility: visible; pointer-events: all; }

        /* ‚îÄ‚îÄ SIZE BTN ‚îÄ‚îÄ */
        .size-btn {
            border: 1.5px solid var(--border);
            background: transparent;
            color: var(--charcoal);
            font-size: 13px;
            font-weight: 500;
            padding: 10px 14px;
            cursor: pointer;
            border-radius: 2px;
            transition: all 0.15s;
        }
        .size-btn:hover:not(:disabled):not(.selected) { border-color: var(--charcoal); }
        .size-btn.selected { background: var(--charcoal); color: #fff; border-color: var(--charcoal); }
        .size-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
        .toast {
            transform: translateX(120%);
            transition: transform 0.4s cubic-bezier(0.68,-0.55,0.265,1.55);
            position: relative;
        }
        .toast.show { transform: translateX(0); }

        /* ‚îÄ‚îÄ FILTER PILLS ‚îÄ‚îÄ */
        .filter-pill {
            font-size: 12px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 2px;
            border: 1.5px solid var(--border);
            background: transparent;
            color: var(--mid);
            cursor: pointer;
            transition: all 0.2s;
        }
        .filter-pill:hover { border-color: var(--charcoal); color: var(--charcoal); }
        .filter-pill.active { background: var(--charcoal); color: #fff; border-color: var(--charcoal); }

        /* ‚îÄ‚îÄ GLOBAL SECTION ‚îÄ‚îÄ */
        .globe-stat {
            text-align: center;
            padding: 40px 20px;
            border-right: 1px solid var(--border);
        }
        .globe-stat:last-child { border-right: none; }
        .globe-num {
            font-family: 'Cormorant Garamond', serif;
            font-size: 58px;
            font-weight: 300;
            color: var(--charcoal);
            line-height: 1;
        }

        /* ‚îÄ‚îÄ QTY CONTROLS ‚îÄ‚îÄ */
        .qty-btn {
            width: 32px; height: 32px;
            border: 1.5px solid var(--border);
            background: transparent;
            cursor: pointer;
            font-size: 16px;
            border-radius: 2px;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.15s;
        }
        .qty-btn:hover:not(:disabled) { border-color: var(--charcoal); }
        .qty-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        /* ‚îÄ‚îÄ CART BADGE ‚îÄ‚îÄ */
        @keyframes cartBounce {
            0%,100% { transform: scale(1); }
            50% { transform: scale(1.35); }
        }
        .cart-badge-anim { animation: cartBounce 0.3s ease; }
    </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê ANNOUNCEMENT BAR ‚ïê‚ïê‚ïê -->
<div class="announce-bar" style="position:fixed;top:0;width:100%;z-index:60;">
    <span class="announce-scroll">
        FREE WORLDWIDE SHIPPING ON ORDERS OVER $75 &nbsp;¬∑&nbsp;
        EVERY PIECE MADE JUST FOR YOU &nbsp;¬∑&nbsp;
        SHIPS TO 180+ COUNTRIES &nbsp;¬∑&nbsp;
        PRINT ON DEMAND ‚Äî ZERO WASTE, ZERO STOCK &nbsp;¬∑&nbsp;
        NEW DESIGNS ADDED WEEKLY
    </span>
</div>

<!-- ‚ïê‚ïê‚ïê TOAST CONTAINER ‚ïê‚ïê‚ïê -->
<div id="toast-container" class="fixed top-24 right-4 z-[65] flex flex-col gap-2 w-80 pointer-events-none"></div>

<!-- ‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê -->
<nav class="nav" id="main-nav">
    <div class="max-w-screen-2xl mx-auto px-6 md:px-10 flex items-center justify-between h-16">

        <!-- Left nav -->
        <div class="hidden md:flex items-center gap-8">
            <a href="#" class="nav-link" onclick="filterProducts('men')">Men</a>
            <a href="#" class="nav-link" onclick="filterProducts('women')">Women</a>
            <a href="#" class="nav-link" onclick="filterProducts('all')">All</a>
        </div>

        <!-- Logo -->
        <a href="#" class="serif text-3xl font-light tracking-widest text-charcoal absolute left-1/2 -translate-x-1/2">LUXA</a>

        <!-- Right nav -->
        <div class="flex items-center gap-5 ml-auto">
            <!-- Search icon -->
            <button class="hidden md:block hover:opacity-60 transition-opacity">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
            </button>

            <!-- Account -->
            <button onclick="toggleAuthModal()" id="auth-trigger" class="hidden md:block hover:opacity-60 transition-opacity">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
            </button>
            <span id="user-display" class="hidden text-sm font-medium text-charcoal"></span>

            <!-- Cart -->
            <button onclick="toggleCart()" class="relative hover:opacity-60 transition-opacity">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
                <span id="cart-badge" class="hidden absolute -top-2 -right-2 bg-gold text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center" style="background:var(--gold);">0</span>
            </button>

            <!-- Mobile menu -->
            <button onclick="toggleMobileMenu()" class="md:hidden hover:opacity-60">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 6h16M4 12h16M4 18h16"/></svg>
            </button>
        </div>
    </div>

    <!-- Mobile menu -->
    <div id="mobile-menu" class="hidden border-t px-6 py-4 space-y-4 bg-cream" style="border-color:var(--border);background:var(--cream);">
        <a href="#" onclick="filterProducts('women');toggleMobileMenu()" class="block nav-link py-1">Women</a>
        <a href="#" onclick="filterProducts('men');toggleMobileMenu()" class="block nav-link py-1">Men</a>
        <a href="#" onclick="filterProducts('all');toggleMobileMenu()" class="block nav-link py-1">All</a>
        <a href="#how-it-works" onclick="toggleMobileMenu()" class="block nav-link py-1">How It Works</a>
        <button onclick="toggleAuthModal()" class="block nav-link py-1 text-left w-full">Sign In</button>
    </div>
</nav>

<!-- ‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê -->
<section class="hero" style="margin-top:34px;">
    <img id="hero-img" src="https://images.unsplash.com/photo-1558769132-cb1aea458c5e?w=1920&h=1200&fit=crop&q=80" alt="LUXA Hero" class="hero-img">
    <div class="hero-overlay"></div>
    <div class="hero-content">
        <p class="hero-label">New Season ¬∑ Global Collection</p>
        <h1 class="hero-title">Wear the<br/><em>World</em></h1>
        <p class="hero-sub">Every piece crafted on demand, shipped to your door ‚Äî wherever in the world that may be.</p>
        <div class="hero-ctas">
            <a href="#products" class="btn-gold">Explore Collection</a>
            <a href="#how-it-works" class="btn-outline" style="color:#fff;border-color:rgba(255,255,255,0.5);">How It Works</a>
        </div>
    </div>
</section>

<!-- ‚ïê‚ïê‚ïê POD TRUST STRIP ‚ïê‚ïê‚ïê -->
<div class="pod-banner">
    <div class="max-w-screen-xl mx-auto px-8 grid grid-cols-2 md:grid-cols-4 divide-x" style="border-color:var(--border);">
        <div class="pod-item px-6 md:px-10">
            <div class="pod-icon">üåç</div>
            <div>
                <div class="font-semibold text-sm">Ships Worldwide</div>
                <div class="text-xs text-gray-500 mt-0.5">180+ countries, free over $75</div>
            </div>
        </div>
        <div class="pod-item px-6 md:px-10">
            <div class="pod-icon">‚úÇÔ∏è</div>
            <div>
                <div class="font-semibold text-sm">Made For You</div>
                <div class="text-xs text-gray-500 mt-0.5">Printed on demand, never mass-produced</div>
            </div>
        </div>
        <div class="pod-item px-6 md:px-10">
            <div class="pod-icon">‚ôªÔ∏è</div>
            <div>
                <div class="font-semibold text-sm">Zero Waste</div>
                <div class="text-xs text-gray-500 mt-0.5">No overstock, no deadstock</div>
            </div>
        </div>
        <div class="pod-item px-6 md:px-10">
            <div class="pod-icon">üîÑ</div>
            <div>
                <div class="font-semibold text-sm">Easy Returns</div>
                <div class="text-xs text-gray-500 mt-0.5">30-day hassle-free policy</div>
            </div>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê CATEGORY GRID ‚ïê‚ïê‚ïê -->
<section class="py-20 px-6 md:px-10 max-w-screen-2xl mx-auto">
    <div class="mb-12">
        <p class="section-eyebrow">Shop by Category</p>
        <h2 class="section-title">Dressed for<br/><em>Every Moment</em></h2>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        <div class="cat-card col-span-2 h-[520px]" onclick="filterProducts('women')">
            <img src="https://images.unsplash.com/photo-1567401893414-76b7b1e5a7a5?w=800&h=1000&fit=crop&q=80" alt="Women">
            <div class="cat-overlay"></div>
            <div class="cat-label">
                <div class="cat-name">Women</div>
                <div class="cat-sub">New Arrivals</div>
            </div>
        </div>
        <div class="cat-card h-[520px]" onclick="filterProducts('men')">
            <img src="https://images.unsplash.com/photo-1489987707025-afc232f7ea0f?w=600&h=1000&fit=crop&q=80" alt="Men">
            <div class="cat-overlay"></div>
            <div class="cat-label">
                <div class="cat-name">Men</div>
                <div class="cat-sub">Essentials</div>
            </div>
        </div>
        <div class="cat-card h-[520px]" onclick="filterProducts('accessories')">
            <img src="https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=600&h=1000&fit=crop&q=80" alt="Accessories">
            <div class="cat-overlay"></div>
            <div class="cat-label">
                <div class="cat-name">Extras</div>
                <div class="cat-sub">Bags & Caps</div>
            </div>
        </div>
    </div>
</section>

<!-- ‚ïê‚ïê‚ïê PRODUCTS ‚ïê‚ïê‚ïê -->
<section id="products" class="py-16 px-6 md:px-10 max-w-screen-2xl mx-auto">
    <div class="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-10">
        <div>
            <p class="section-eyebrow">The Collection</p>
            <h2 class="section-title">Latest <em>Drops</em></h2>
        </div>
        <div class="flex gap-2 flex-wrap" id="filter-btns">
            <button onclick="filterProducts('all')" class="filter-pill active" data-filter="all">All</button>
            <button onclick="filterProducts('women')" class="filter-pill" data-filter="women">Women</button>
            <button onclick="filterProducts('men')" class="filter-pill" data-filter="men">Men</button>
            <button onclick="filterProducts('accessories')" class="filter-pill" data-filter="accessories">Accessories</button>
        </div>
    </div>

    <div id="products-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-5 gap-y-12">
        <!-- Populated by JS -->
    </div>
</section>

<!-- ‚ïê‚ïê‚ïê HOW IT WORKS ‚ïê‚ïê‚ïê -->
<section id="how-it-works" class="py-24 px-6 md:px-10" style="background:var(--charcoal);">
    <div class="max-w-screen-xl mx-auto grid md:grid-cols-2 gap-20 items-center">
        <div>
            <p class="section-eyebrow" style="color:var(--gold-lt);">Print on Demand</p>
            <h2 class="section-title" style="color:#fff;">Made When<br/><em>You Order</em></h2>
            <p class="text-gray-400 mt-6 leading-relaxed max-w-md">We don't hold stock. Every LUXA piece is individually printed and assembled the moment you place your order ‚Äî reducing waste and ensuring the freshest quality every time.</p>

            <div class="mt-12">
                <div class="how-step" style="border-color:rgba(255,255,255,0.1);">
                    <div class="step-num" style="color:rgba(255,255,255,0.15);">01</div>
                    <div>
                        <div class="text-white font-semibold mb-1">You Choose</div>
                        <div class="text-gray-400 text-sm leading-relaxed">Browse hundreds of styles. Pick your design, size, and colour.</div>
                    </div>
                </div>
                <div class="how-step" style="border-color:rgba(255,255,255,0.1);">
                    <div class="step-num" style="color:rgba(255,255,255,0.15);">02</div>
                    <div>
                        <div class="text-white font-semibold mb-1">We Print</div>
                        <div class="text-gray-400 text-sm leading-relaxed">Your piece is printed using premium DTG or sublimation technology within 2‚Äì4 days.</div>
                    </div>
                </div>
                <div class="how-step" style="border-color:rgba(255,255,255,0.1);">
                    <div class="step-num" style="color:rgba(255,255,255,0.15);">03</div>
                    <div>
                        <div class="text-white font-semibold mb-1">World Delivers</div>
                        <div class="text-gray-400 text-sm leading-relaxed">Shipped from fulfilment centres in the US, EU, and Asia ‚Äî fast delivery everywhere.</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
            <img src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=500&h=600&fit=crop&q=80" alt="Printing" class="w-full h-64 object-cover rounded-sm">
            <img src="https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=500&h=600&fit=crop&q=80" alt="Quality" class="w-full h-64 object-cover rounded-sm mt-12">
            <img src="https://images.unsplash.com/photo-1583743814966-8936f5b7be1a?w=500&h=600&fit=crop&q=80" alt="Shipping" class="w-full h-64 object-cover rounded-sm -mt-12">
            <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=500&h=600&fit=crop&q=80" alt="Delivered" class="w-full h-64 object-cover rounded-sm">
        </div>
    </div>
</section>

<!-- ‚ïê‚ïê‚ïê GLOBAL REACH ‚ïê‚ïê‚ïê -->
<section class="py-20 px-6" style="background:var(--warm); border-top:1px solid var(--border); border-bottom:1px solid var(--border);">
    <div class="max-w-screen-xl mx-auto">
        <div class="text-center mb-14">
            <p class="section-eyebrow">Our Reach</p>
            <h2 class="section-title">Worn <em>Everywhere</em></h2>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 divide-x" style="border-color:var(--border);">
            <div class="globe-stat">
                <div class="globe-num">180<span class="text-3xl">+</span></div>
                <div class="text-sm text-gray-500 mt-2 uppercase tracking-widest">Countries Served</div>
            </div>
            <div class="globe-stat">
                <div class="globe-num">3</div>
                <div class="text-sm text-gray-500 mt-2 uppercase tracking-widest">Fulfilment Regions</div>
            </div>
            <div class="globe-stat">
                <div class="globe-num">48<span class="text-2xl">hr</span></div>
                <div class="text-sm text-gray-500 mt-2 uppercase tracking-widest">Avg. Print Time</div>
            </div>
            <div class="globe-stat">
                <div class="globe-num">0</div>
                <div class="text-sm text-gray-500 mt-2 uppercase tracking-widest">Waste Per Order</div>
            </div>
        </div>
    </div>
</section>

<!-- ‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê -->
<footer class="py-20 px-6 md:px-10" style="background:var(--charcoal); color:#fff;">
    <div class="max-w-screen-xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-5 gap-12 mb-16">
            <div class="md:col-span-2">
                <div class="serif text-4xl font-light tracking-widest mb-4">LUXA</div>
                <p class="text-gray-400 text-sm leading-relaxed max-w-xs">Global fashion, made on demand. Every piece made for you, shipped anywhere in the world.</p>
                <p class="text-gray-600 text-xs mt-4">luxa-clothing.com</p>
            </div>
            <div>
                <h4 class="text-xs uppercase tracking-widest text-gray-400 mb-5">Shop</h4>
                <ul class="space-y-3 text-sm text-gray-400">
                    <li><a href="#" onclick="filterProducts('women')" class="hover:text-white transition-colors">Women</a></li>
                    <li><a href="#" onclick="filterProducts('men')" class="hover:text-white transition-colors">Men</a></li>
                    <li><a href="#" onclick="filterProducts('accessories')" class="hover:text-white transition-colors">Accessories</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">New Arrivals</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-xs uppercase tracking-widest text-gray-400 mb-5">Help</h4>
                <ul class="space-y-3 text-sm text-gray-400">
                    <li><a href="#how-it-works" class="hover:text-white transition-colors">How It Works</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Shipping Info</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Returns</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Size Guide</a></li>
                </ul>
            </div>
            <div>
                <h4 class="text-xs uppercase tracking-widest text-gray-400 mb-5">About</h4>
                <ul class="space-y-3 text-sm text-gray-400">
                    <li><a href="#" class="hover:text-white transition-colors">Our Story</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Sustainability</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Contact</a></li>
                </ul>
            </div>
        </div>
        <div class="border-t pt-8 flex flex-col md:flex-row justify-between gap-4 text-xs text-gray-600" style="border-color:rgba(255,255,255,0.08);">
            <p>¬© 2025 LUXA. All rights reserved. luxa-clothing.com</p>
            <div class="flex gap-6">
                <a href="#" class="hover:text-gray-300 transition-colors">Privacy</a>
                <a href="#" class="hover:text-gray-300 transition-colors">Terms</a>
                <a href="#" class="hover:text-gray-300 transition-colors">Cookies</a>
            </div>
        </div>
    </div>
</footer>

<!-- ‚ïê‚ïê‚ïê CART SIDEBAR ‚ïê‚ïê‚ïê -->
<div id="cart-overlay-bg" class="cart-overlay-bg" onclick="toggleCart()"></div>
<div id="cart-sidebar" class="cart-sidebar">
    <div class="flex items-center justify-between px-6 py-5 border-b" style="border-color:var(--border);">
        <div>
            <h2 class="serif text-2xl font-light">Your Bag</h2>
            <p class="text-xs text-gray-500 mt-0.5">Made on demand ‚Äî just for you</p>
        </div>
        <button onclick="toggleCart()" class="hover:opacity-60 transition-opacity">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
    </div>
    <div id="cart-items" class="hidden flex-1 overflow-y-auto px-6 py-4 space-y-5"></div>
    <div id="cart-empty" class="flex-1 flex flex-col items-center justify-center px-6 py-12 text-center">
        <div class="serif text-5xl text-gray-300 mb-4">‚àÖ</div>
        <p class="text-gray-500 mb-1 font-medium">Your bag is empty</p>
        <p class="text-gray-400 text-sm mb-6">Discover pieces made just for you</p>
        <button onclick="toggleCart()" class="btn-dark" style="padding:10px 24px;">Browse Collection</button>
    </div>
    <div id="cart-footer" class="hidden border-t px-6 py-5 space-y-4" style="border-color:var(--border);">
        <div class="flex justify-between">
            <span class="text-sm text-gray-500">Subtotal</span>
            <span id="cart-subtotal" class="font-semibold text-lg">$0.00</span>
        </div>
        <p class="text-xs text-gray-400">Shipping & taxes at checkout ¬∑ Est. delivery 5‚Äì10 days</p>
        <button onclick="proceedToCheckout()" id="checkout-btn" class="btn-gold w-full text-center" style="padding:16px;">Checkout</button>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê PRODUCT MODAL ‚ïê‚ïê‚ïê -->
<div id="product-modal" class="modal-overlay" onclick="if(event.target===this)closeModal()">
    <div class="modal-box" id="modal-box">
        <div id="modal-inner"></div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê AUTH MODAL ‚ïê‚ïê‚ïê -->
<div id="auth-modal" class="auth-modal">
    <div class="bg-white rounded-sm max-w-md w-full mx-4 p-10 relative" style="background:var(--cream);">
        <button onclick="toggleAuthModal()" class="absolute top-5 right-5 hover:opacity-60 transition-opacity">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
        <div class="serif text-4xl font-light mb-1" id="auth-title">Sign In</div>
        <p class="text-sm text-gray-500 mb-8" id="auth-subtitle">Welcome back to LUXA</p>

        <form id="login-form" class="space-y-4" onsubmit="event.preventDefault();handleLogin()">
            <div>
                <label class="text-xs uppercase tracking-widest text-gray-500 block mb-2">Email</label>
                <input type="email" id="login-email" required class="w-full px-4 py-3 border text-sm focus:outline-none transition-colors" style="border-color:var(--border);background:var(--warm);" onfocus="this.style.borderColor='var(--charcoal)'" onblur="this.style.borderColor='var(--border)'">
            </div>
            <div>
                <label class="text-xs uppercase tracking-widest text-gray-500 block mb-2">Password</label>
                <input type="password" id="login-password" required class="w-full px-4 py-3 border text-sm focus:outline-none transition-colors" style="border-color:var(--border);background:var(--warm);" onfocus="this.style.borderColor='var(--charcoal)'" onblur="this.style.borderColor='var(--border)'">
            </div>
            <div id="login-error" class="hidden text-red-600 text-sm bg-red-50 px-3 py-2 rounded"></div>
            <button type="submit" id="login-btn" class="btn-dark w-full text-center" style="padding:14px;">Sign In</button>
            <p class="text-center text-sm text-gray-500">Don't have an account? <button type="button" onclick="toggleAuthMode()" class="underline text-charcoal font-semibold">Sign up</button></p>
        </form>

        <form id="register-form" class="hidden space-y-4" onsubmit="event.preventDefault();handleRegister()">
            <div>
                <label class="text-xs uppercase tracking-widest text-gray-500 block mb-2">Name</label>
                <input type="text" id="reg-username" required class="w-full px-4 py-3 border text-sm focus:outline-none" style="border-color:var(--border);background:var(--warm);" onfocus="this.style.borderColor='var(--charcoal)'" onblur="this.style.borderColor='var(--border)'">
            </div>
            <div>
                <label class="text-xs uppercase tracking-widest text-gray-500 block mb-2">Email</label>
                <input type="email" id="reg-email" required class="w-full px-4 py-3 border text-sm focus:outline-none" style="border-color:var(--border);background:var(--warm);" onfocus="this.style.borderColor='var(--charcoal)'" onblur="this.style.borderColor='var(--border)'">
            </div>
            <div>
                <label class="text-xs uppercase tracking-widest text-gray-500 block mb-2">Password (min 6)</label>
                <input type="password" id="reg-password" required minlength="6" class="w-full px-4 py-3 border text-sm focus:outline-none" style="border-color:var(--border);background:var(--warm);" onfocus="this.style.borderColor='var(--charcoal)'" onblur="this.style.borderColor='var(--border)'">
            </div>
            <div>
                <label class="text-xs uppercase tracking-widest text-gray-500 block mb-2">Confirm Password</label>
                <input type="password" id="reg-confirm" required class="w-full px-4 py-3 border text-sm focus:outline-none" style="border-color:var(--border);background:var(--warm);" onfocus="this.style.borderColor='var(--charcoal)'" onblur="this.style.borderColor='var(--border)'">
            </div>
            <div id="register-error" class="hidden text-red-600 text-sm bg-red-50 px-3 py-2 rounded"></div>
            <div id="register-success" class="hidden text-green-700 text-sm bg-green-50 px-3 py-2 rounded">Account created! Check your email to confirm.</div>
            <div class="flex items-start gap-2 text-xs text-gray-500">
                <input type="checkbox" id="terms-check" required class="mt-0.5">
                <span>I agree to the <a href="#" class="underline">Terms</a> & <a href="#" class="underline">Privacy Policy</a></span>
            </div>
            <button type="submit" id="register-btn" class="btn-dark w-full text-center" style="padding:14px;">Create Account</button>
            <p class="text-center text-sm text-gray-500">Have an account? <button type="button" onclick="toggleAuthMode()" class="underline text-charcoal font-semibold">Sign in</button></p>
        </form>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê JAVASCRIPT ‚ïê‚ïê‚ïê -->
<script>
// ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const SUPABASE_URL  = 'https://ukewtbhpcsxahkocmhfm.supabase.co';
const SUPABASE_KEY  = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVrZXd0YmhwY3N4YWhrb2NtaGZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4NzUzMjksImV4cCI6MjA4NTQ1MTMyOX0.Ujnkq7pX-eA6ZLXcf2WwOd4LWrWuD4bcmb0sRJxL2QA';
const STRIPE_KEY    = 'pk_test_51SxS9vEvXdzvVm9XvsJ9ucARLlhvs9MfZ6w1ePcNZnZvFNDQoAitDHV9v4Jlwyh3TXmaFMVQ3n5N8YA8GnnlLUWn00p8IMjS9n';

let supabaseClient = null, stripe = null, currentUser = null, isConnected = false;

// ‚îÄ‚îÄ PRODUCTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PRODUCTS = [
    {
        id:'p001', name:'Heritage Tee', category:'women', gender:'Women',
        price:34.99, badge:'new',
        image:'https://images.unsplash.com/photo-1618354691373-d851c5c3a990?w=600&h=800&fit=crop&q=80',
        desc:'A relaxed-fit essential in heavyweight 100% organic cotton. Printed to order in your chosen colour.',
        sizes:['XS','S','M','L','XL','2XL'], stock:{XS:99,S:99,M:99,L:99,XL:99,'2XL':99}
    },
    {
        id:'p002', name:'Drape Midi Dress', category:'women', gender:'Women',
        price:64.99, badge:'pod',
        image:'https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=600&h=800&fit=crop&q=80',
        desc:'Effortlessly flowing silhouette in recycled fabric. Each dress is printed individually on-demand.',
        sizes:['XS','S','M','L','XL'], stock:{XS:99,S:99,M:99,L:99,XL:99}
    },
    {
        id:'p003', name:'Meridian Hoodie', category:'men', gender:'Men',
        price:69.99, badge:'new',
        image:'https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=600&h=800&fit=crop&q=80',
        desc:'Heavyweight fleece with a clean-line front graphic. Made on demand ‚Äî your size, your colour.',
        sizes:['S','M','L','XL','2XL'], stock:{S:99,M:99,L:99,XL:99,'2XL':99}
    },
    {
        id:'p004', name:'Canvas Oversized Tee', category:'men', gender:'Men',
        price:39.99, badge:'pod',
        image:'https://images.unsplash.com/photo-1583743814966-8936f5b7be1a?w=600&h=800&fit=crop&q=80',
        desc:'Drop-shoulder street silhouette. Pigment-dyed and printed to order for a lived-in look.',
        sizes:['S','M','L','XL','2XL'], stock:{S:99,M:99,L:99,XL:99,'2XL':99}
    },
    {
        id:'p005', name:'Woven Bucket Hat', category:'accessories', gender:'Unisex',
        price:29.99, badge:'new',
        image:'https://images.unsplash.com/photo-1521369909029-2afed882baee?w=600&h=800&fit=crop&q=80',
        desc:'100% cotton canvas bucket hat with custom LUXA embroidery. One size, worldwide delivery.',
        sizes:['One Size'], stock:{'One Size':99}
    },
    {
        id:'p006', name:'Everyday Cargo Pant', category:'women', gender:'Women',
        price:74.99, badge:'pod',
        image:'https://images.unsplash.com/photo-1509631179647-0177331693ae?w=600&h=800&fit=crop&q=80',
        desc:'Relaxed cargo trousers with multiple pockets. Cut and assembled to your size on demand.',
        sizes:['XS','S','M','L','XL'], stock:{XS:99,S:99,M:99,L:99,XL:99}
    },
    {
        id:'p007', name:'Structured Varsity Jacket', category:'men', gender:'Men',
        price:99.99, badge:'pod',
        image:'https://images.unsplash.com/photo-1591047139829-d91aecb6caea?w=600&h=800&fit=crop&q=80',
        desc:'A classic reborn. Printed lining, embroidered crest ‚Äî fully assembled when you place your order.',
        sizes:['S','M','L','XL','2XL'], stock:{S:99,M:99,L:99,XL:99,'2XL':99}
    },
    {
        id:'p008', name:'Mini Crossbody Bag', category:'accessories', gender:'Unisex',
        price:44.99, badge:'new',
        image:'https://images.unsplash.com/photo-1548036328-c9fa89d128fa?w=600&h=800&fit=crop&q=80',
        desc:'Compact canvas crossbody with custom print options. Ships from the fulfilment centre nearest you.',
        sizes:['One Size'], stock:{'One Size':99}
    }
];

// ‚îÄ‚îÄ CART ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let cart = [];
const LS_CART = 'luxa_cart';
const LS_USER = 'luxa_user';
const LS_USERS = 'luxa_users';

function loadCart() {
    try { cart = JSON.parse(localStorage.getItem(LS_CART)) || []; } catch { cart = []; }
    renderCartUI();
}
function saveCart() {
    localStorage.setItem(LS_CART, JSON.stringify(cart));
    renderCartUI();
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.addEventListener('load', () => {
    initStripe();
    loadCart();
    renderProducts('all');
    initAuth();
    initScrollEffects();
    checkURLParams();
});

function checkURLParams() {
    const p = new URLSearchParams(window.location.search);
    if (p.get('success') === 'true') { showToast('Order confirmed! Your piece is being made.','success'); clearCart(); history.replaceState({},document.title,location.pathname); }
    if (p.get('canceled') === 'true') { showToast('Checkout cancelled ‚Äî your bag is saved.','info'); history.replaceState({},document.title,location.pathname); }
}

function initStripe() {
    try { if (STRIPE_KEY.startsWith('pk_')) stripe = Stripe(STRIPE_KEY); } catch(e) {}
}

async function initAuth() {
    const saved = localStorage.getItem(LS_USER);
    if (saved) { currentUser = JSON.parse(saved); updateUserDisplay(); }
    try {
        if (typeof supabase !== 'undefined') {
            supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            const { data } = await supabaseClient.auth.getSession();
            if (data?.session?.user) { currentUser = data.session.user; localStorage.setItem(LS_USER, JSON.stringify(currentUser)); updateUserDisplay(); }
            isConnected = true;
        }
    } catch(e) {}
}

function initScrollEffects() {
    const nav = document.getElementById('main-nav');
    const heroImg = document.getElementById('hero-img');
    window.addEventListener('scroll', () => {
        nav.classList.toggle('scrolled', window.scrollY > 40);
        if (heroImg) heroImg.style.transform = `translateY(${window.scrollY * 0.4}px) scale(1.1)`;
    }, { passive: true });
}

function updateUserDisplay() {
    if (!currentUser) return;
    const name = currentUser.user_metadata?.username || currentUser.email?.split('@')[0] || 'You';
    document.getElementById('user-display').textContent = name;
    document.getElementById('user-display').classList.remove('hidden');
    document.getElementById('auth-trigger').innerHTML = `<button onclick="handleLogout()" class="nav-link">Logout</button>`;
}

// ‚îÄ‚îÄ PRODUCT RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderProducts(filter) {
    const grid = document.getElementById('products-grid');
    const list = filter === 'all' ? PRODUCTS : PRODUCTS.filter(p => p.category === filter);
    grid.innerHTML = list.map(p => `
        <div class="prod-card fade-in" onclick="openModal('${p.id}')">
            <div class="prod-img-wrap">
                <img src="${p.image}" alt="${p.name}" loading="lazy">
                ${p.badge ? `<span class="prod-badge ${p.badge}">${p.badge === 'pod' ? 'Made on Demand' : 'New'}</span>` : ''}
            </div>
            <div class="prod-meta mt-3">${p.gender} ¬∑ ${p.category.charAt(0).toUpperCase()+p.category.slice(1)}</div>
            <div class="prod-name">${p.name}</div>
            <div class="prod-price">$${p.price.toFixed(2)}</div>
        </div>
    `).join('');

    document.querySelectorAll('.filter-pill').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filter);
    });
    document.getElementById('products').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function filterProducts(filter) { renderProducts(filter); }

// ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let selectedSize = null;

function openModal(id) {
    selectedSize = null;
    const p = PRODUCTS.find(x => x.id === id);
    if (!p) return;
    document.getElementById('modal-inner').innerHTML = `
        <div class="relative">
            <button onclick="closeModal()" class="absolute top-5 right-5 z-10 hover:opacity-60 transition-opacity">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
            <div class="grid md:grid-cols-2">
                <div class="aspect-square overflow-hidden" style="background:var(--warm);">
                    <img src="${p.image}" alt="${p.name}" class="w-full h-full object-cover">
                </div>
                <div class="p-8 md:p-10 flex flex-col">
                    <p class="text-xs uppercase tracking-widest mb-2" style="color:var(--mid);">${p.gender} ¬∑ ${p.category}</p>
                    <h2 class="serif text-4xl font-light mb-1">${p.name}</h2>
                    <p class="text-2xl font-semibold mb-6">$${p.price.toFixed(2)}</p>
                    <p class="text-sm leading-relaxed mb-8" style="color:var(--mid);">${p.desc}</p>

                    <div class="mb-2">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-xs uppercase tracking-widest" style="color:var(--mid);">Select Size</span>
                            <a href="#" class="text-xs underline" style="color:var(--mid);">Size Guide</a>
                        </div>
                        <div class="flex flex-wrap gap-2" id="size-btns">
                            ${p.sizes.map(s => `
                                <button onclick="selectSize('${s}')" class="size-btn" data-size="${s}">${s}</button>
                            `).join('')}
                        </div>
                        <p id="size-err" class="hidden text-red-500 text-xs mt-2">Please select a size</p>
                    </div>

                    <div class="mt-auto pt-8 space-y-3">
                        <button onclick="addFromModal('${p.id}')" class="btn-dark w-full text-center" style="padding:16px;border-radius:2px;">Add to Bag</button>
                        <p class="text-center text-xs" style="color:var(--mid);">‚úì Made on demand ¬∑ Ships in 5‚Äì10 days ¬∑ Free over $75</p>
                    </div>
                </div>
            </div>
        </div>`;
    document.getElementById('product-modal').classList.add('open');
    document.body.style.overflow = 'hidden';
}

function closeModal() {
    document.getElementById('product-modal').classList.remove('open');
    document.body.style.overflow = '';
}

function selectSize(s) {
    selectedSize = s;
    document.querySelectorAll('.size-btn').forEach(b => b.classList.toggle('selected', b.dataset.size === s));
    document.getElementById('size-err').classList.add('hidden');
}

function addFromModal(id) {
    if (!selectedSize) { document.getElementById('size-err').classList.remove('hidden'); return; }
    addToCart(id, selectedSize);
    closeModal();
}

// ‚îÄ‚îÄ CART LOGIC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addToCart(productId, size, qty=1) {
    const p = PRODUCTS.find(x => x.id === productId);
    if (!p) return;
    const idx = cart.findIndex(i => i.productId === productId && i.size === size);
    if (idx > -1) { cart[idx].quantity += qty; } else { cart.push({ productId, size, quantity: qty, price: p.price }); }
    saveCart();
    showToast(`${p.name} added to bag`, 'success');
    const badge = document.getElementById('cart-badge');
    badge.classList.add('cart-badge-anim');
    setTimeout(() => badge.classList.remove('cart-badge-anim'), 300);
}

function removeFromCart(idx) { cart.splice(idx, 1); saveCart(); }

function updateQty(idx, qty) {
    if (qty < 1) { removeFromCart(idx); return; }
    cart[idx].quantity = qty;
    saveCart();
}

function clearCart() { cart = []; saveCart(); }

function cartTotal() { return cart.reduce((t,i) => t + i.price * i.quantity, 0); }
function cartCount() { return cart.reduce((t,i) => t + i.quantity, 0); }

function renderCartUI() {
    const badge     = document.getElementById('cart-badge');
    const items     = document.getElementById('cart-items');
    const empty     = document.getElementById('cart-empty');
    const footer    = document.getElementById('cart-footer');
    const subtotal  = document.getElementById('cart-subtotal');
    const count     = cartCount();

    badge.textContent = count > 99 ? '99+' : count;
    badge.classList.toggle('hidden', count === 0);

    if (cart.length === 0) {
        items.classList.add('hidden'); empty.classList.remove('hidden'); footer.classList.add('hidden');
    } else {
        items.classList.remove('hidden'); empty.classList.add('hidden'); footer.classList.remove('hidden');
        items.innerHTML = cart.map((item, i) => {
            const p = PRODUCTS.find(x => x.id === item.productId);
            if (!p) return '';
            return `
            <div class="flex gap-4 pb-5 border-b" style="border-color:var(--border);">
                <div class="w-20 h-20 overflow-hidden flex-shrink-0" style="background:var(--warm);">
                    <img src="${p.image}" class="w-full h-full object-cover" alt="${p.name}">
                </div>
                <div class="flex-1 min-w-0">
                    <p class="serif text-base font-light leading-tight">${p.name}</p>
                    <p class="text-xs mt-1" style="color:var(--mid);">Size: ${item.size}</p>
                    <p class="text-sm font-semibold mt-1">$${item.price.toFixed(2)}</p>
                    <div class="flex items-center gap-3 mt-2">
                        <button onclick="updateQty(${i},${item.quantity-1})" class="qty-btn" ${item.quantity<=1?'disabled':''}>‚àí</button>
                        <span class="text-sm w-5 text-center">${item.quantity}</span>
                        <button onclick="updateQty(${i},${item.quantity+1})" class="qty-btn">+</button>
                    </div>
                </div>
                <button onclick="removeFromCart(${i})" class="text-gray-300 hover:text-gray-600 transition-colors flex-shrink-0">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>`;
        }).join('');
        subtotal.textContent = `$${cartTotal().toFixed(2)}`;
    }
}

// ‚îÄ‚îÄ CHECKOUT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function proceedToCheckout() {
    if (cart.length === 0) { showToast('Your bag is empty','error'); return; }
    if (!currentUser) { toggleCart(); toggleAuthModal(); showToast('Sign in to complete your order','info'); return; }
    const btn = document.getElementById('checkout-btn');
    btn.disabled = true; btn.textContent = 'Processing‚Ä¶';
    try {
        if (!stripe) {
            await new Promise(r => setTimeout(r, 1400));
            showToast('Demo: Stripe not configured','info');
            clearCart(); toggleCart(); return;
        }
        const res = await fetch('/api/create-checkout-session', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ items: cart.map(i => ({ productId:i.productId, size:i.size, quantity:i.quantity })), userId: currentUser?.id||'guest' })
        });
        const { sessionId } = await res.json();
        const { error } = await stripe.redirectToCheckout({ sessionId });
        if (error) throw error;
    } catch(e) { showToast('Checkout failed. Please try again.','error'); }
    finally { btn.disabled = false; btn.textContent = 'Checkout'; }
}

// ‚îÄ‚îÄ CART TOGGLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleCart() {
    const sb = document.getElementById('cart-sidebar');
    const ov = document.getElementById('cart-overlay-bg');
    sb.classList.toggle('open'); ov.classList.toggle('open');
    document.body.style.overflow = sb.classList.contains('open') ? 'hidden' : '';
}

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleAuthModal() {
    const m = document.getElementById('auth-modal');
    m.classList.toggle('open');
    document.body.style.overflow = m.classList.contains('open') ? 'hidden' : '';
}

function toggleAuthMode() {
    document.getElementById('login-form').classList.toggle('hidden');
    document.getElementById('register-form').classList.toggle('hidden');
    const isReg = document.getElementById('register-form').classList.contains('hidden') === false;
    document.getElementById('auth-title').textContent = isReg ? 'Create Account' : 'Sign In';
    document.getElementById('auth-subtitle').textContent = isReg ? 'Join LUXA today' : 'Welcome back to LUXA';
    ['login-error','register-error','register-success'].forEach(id => document.getElementById(id).classList.add('hidden'));
}

async function handleLogin() {
    const email = document.getElementById('login-email').value;
    const pass  = document.getElementById('login-password').value;
    const btn   = document.getElementById('login-btn');
    if (!email||!pass) { showAuthError('Please fill in all fields','login-error'); return; }
    btn.disabled = true; btn.textContent = 'Signing in‚Ä¶';
    try {
        let user;
        if (!isConnected) {
            const users = JSON.parse(localStorage.getItem(LS_USERS)||'[]');
            user = users.find(u => u.email===email && u.password===pass);
            if (!user) throw new Error('Invalid email or password');
            user = { id:user.id, email:user.email, user_metadata:user.user_metadata };
        } else {
            const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password:pass });
            if (error) throw error;
            user = data.user;
        }
        currentUser = user; localStorage.setItem(LS_USER, JSON.stringify(user));
        toggleAuthModal(); updateUserDisplay(); showToast('Welcome back!','success');
    } catch(e) { showAuthError(e.message,'login-error'); }
    finally { btn.disabled=false; btn.textContent='Sign In'; }
}

async function handleRegister() {
    const name  = document.getElementById('reg-username').value.trim();
    const email = document.getElementById('reg-email').value.trim();
    const pass  = document.getElementById('reg-password').value;
    const conf  = document.getElementById('reg-confirm').value;
    const btn   = document.getElementById('register-btn');
    if (!name||!email||!pass) { showAuthError('Please fill in all fields','register-error'); return; }
    if (pass !== conf) { showAuthError('Passwords do not match','register-error'); return; }
    if (pass.length < 6) { showAuthError('Password must be at least 6 characters','register-error'); return; }
    btn.disabled=true; btn.textContent='Creating account‚Ä¶';
    try {
        if (!isConnected) {
            const users = JSON.parse(localStorage.getItem(LS_USERS)||'[]');
            if (users.find(u => u.email===email)) throw new Error('Email already registered');
            const newUser = { id:'local_'+Date.now(), email, user_metadata:{username:name} };
            users.push({...newUser, password:pass});
            localStorage.setItem(LS_USERS, JSON.stringify(users));
            localStorage.setItem(LS_USER, JSON.stringify(newUser));
            currentUser = newUser;
            document.getElementById('register-success').classList.remove('hidden');
            setTimeout(() => { toggleAuthModal(); updateUserDisplay(); }, 2000);
        } else {
            const { data, error } = await supabaseClient.auth.signUp({ email, password:pass, options:{ data:{ username:name } } });
            if (error) throw error;
            if (data.session) { currentUser=data.user; localStorage.setItem(LS_USER,JSON.stringify(data.user)); toggleAuthModal(); updateUserDisplay(); showToast('Welcome to LUXA!','success'); }
            else { document.getElementById('register-success').classList.remove('hidden'); }
        }
    } catch(e) { showAuthError(e.message,'register-error'); }
    finally { btn.disabled=false; btn.textContent='Create Account'; }
}

function handleLogout() {
    if (isConnected && supabaseClient) supabaseClient.auth.signOut();
    localStorage.removeItem(LS_USER);
    currentUser = null; location.reload();
}

function showAuthError(msg, id) {
    const el = document.getElementById(id);
    el.textContent = msg; el.classList.remove('hidden');
    setTimeout(() => el.classList.add('hidden'), 5000);
}

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg, type) {
    const c = document.getElementById('toast-container');
    const t = document.createElement('div');
    const bg = { success:'#1C1C1E', error:'#B91C1C', info:'#B8955A' }[type]||'#1C1C1E';
    t.className = 'toast pointer-events-auto text-white text-sm font-medium px-5 py-3 rounded-sm shadow-xl';
    t.style.background = bg;
    t.textContent = msg;
    c.appendChild(t);
    setTimeout(() => t.classList.add('show'), 60);
    setTimeout(() => { t.classList.remove('show'); setTimeout(() => t.remove(), 500); }, 3200);
}

// ‚îÄ‚îÄ MOBILE MENU ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('hidden'); }

// ‚îÄ‚îÄ ESCAPE KEY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('keydown', e => {
    if (e.key !== 'Escape') return;
    closeModal();
    if (document.getElementById('auth-modal').classList.contains('open')) toggleAuthModal();
    if (document.getElementById('cart-sidebar').classList.contains('open')) toggleCart();
});
</script>
</body>
</html>
